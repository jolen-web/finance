{% extends "base.html" %}

{% block title %}Create New Scenario - Finance Tracker{% endblock %}

{% block content %}
<div class="row mb-3">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1><i class="fas fa-plus-circle"></i> Create New Scenario</h1>
                <p class="text-muted">Model your financial future</p>
            </div>
            <a href="{{ url_for('scenario_planner.index') }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left"></i> Back
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-8 offset-md-2">
        <div class="card">
            <div class="card-body">
                <form method="POST">
                    <!-- Basic Info -->
                    <div class="mb-3">
                        <label for="name" class="form-label">Scenario Name *</label>
                        <input type="text" class="form-control" id="name" name="name" required>
                    </div>

                    <div class="mb-3">
                        <label for="scenario_type" class="form-label">Scenario Type *</label>
                        <select class="form-select" id="scenario_type" name="scenario_type" required onchange="showScenarioFields()">
                            <option value="">Select type...</option>
                            <option value="cash_flow_forecast" {% if request.args.get('type') == 'cash_flow_forecast' %}selected{% endif %}>
                                Cash Flow Forecast
                            </option>
                            <option value="savings_goal" {% if request.args.get('type') == 'savings_goal' %}selected{% endif %}>
                                Savings Goal
                            </option>
                            <option value="debt_payoff" {% if request.args.get('type') == 'debt_payoff' %}selected{% endif %}>
                                Debt Payoff
                            </option>
                            <option value="retirement" {% if request.args.get('type') == 'retirement' %}selected{% endif %}>
                                Retirement Planning
                            </option>
                            <option value="what_if" {% if request.args.get('type') == 'what_if' %}selected{% endif %}>
                                What-If Analysis
                            </option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="duration_months" class="form-label">Duration (Months) *</label>
                        <input type="number" class="form-control" id="duration_months" name="duration_months" min="1" max="600" value="12" required>
                    </div>

                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="2"></textarea>
                    </div>

                    <hr>

                    <!-- Cash Flow Forecast Fields -->
                    <div id="fields_cash_flow_forecast" class="scenario-fields" style="display: none;">
                        <h5>Cash Flow Parameters</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Monthly Income</label>
                                <input type="number" class="form-control" name="monthly_income" step="0.01" value="{{ historical.avg_monthly_income }}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Income Growth Rate (% annually)</label>
                                <input type="number" class="form-control" name="income_growth_rate" step="0.1" value="3">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Monthly Expenses</label>
                                <input type="number" class="form-control" name="monthly_expenses" step="0.01" value="{{ historical.avg_monthly_expenses }}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Expense Growth Rate (% annually)</label>
                                <input type="number" class="form-control" name="expense_growth_rate" step="0.1" value="2">
                            </div>
                        </div>
                    </div>

                    <!-- Savings Goal Fields -->
                    <div id="fields_savings_goal" class="scenario-fields" style="display: none;">
                        <h5>Savings Goal Parameters</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Goal Amount *</label>
                                <input type="number" class="form-control" name="goal_amount" step="0.01">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Current Savings</label>
                                <input type="number" class="form-control" name="current_savings" step="0.01" value="0">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Monthly Contribution</label>
                                <input type="number" class="form-control" name="monthly_contribution" step="0.01">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Interest Rate (% annually)</label>
                                <input type="number" class="form-control" name="interest_rate" step="0.1" value="2">
                            </div>
                        </div>
                    </div>

                    <!-- Debt Payoff Fields -->
                    <div id="fields_debt_payoff" class="scenario-fields" style="display: none;">
                        <h5>Debt Payoff Parameters</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Principal (Debt Amount) *</label>
                                <input type="number" class="form-control" name="principal" step="0.01">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Annual Interest Rate (%)</label>
                                <input type="number" class="form-control" name="annual_interest_rate" step="0.1" value="15">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Monthly Payment</label>
                                <input type="number" class="form-control" name="monthly_payment" step="0.01">
                            </div>
                        </div>
                    </div>

                    <!-- Retirement Fields -->
                    <div id="fields_retirement" class="scenario-fields" style="display: none;">
                        <h5>Retirement Planning Parameters</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Current Age *</label>
                                <input type="number" class="form-control" name="current_age" min="18" max="100" value="30">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Retirement Age *</label>
                                <input type="number" class="form-control" name="retirement_age" min="40" max="100" value="65">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Current Retirement Savings</label>
                                <input type="number" class="form-control" name="current_retirement_savings" step="0.01" value="0">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Monthly Contribution</label>
                                <input type="number" class="form-control" name="monthly_contribution" step="0.01">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Employer Match (%)</label>
                                <input type="number" class="form-control" name="employer_match_pct" step="0.1" value="50">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Expected Annual Return (%)</label>
                                <input type="number" class="form-control" name="annual_return" step="0.1" value="7">
                            </div>
                        </div>
                    </div>

                    <!-- What-If Fields -->
                    <div id="fields_what_if" class="scenario-fields" style="display: none;">
                        <h5>What-If Analysis Parameters</h5>
                        <div class="alert alert-info">
                            <small>Current averages: Income {{ historical.avg_monthly_income|currency }}, Expenses {{ historical.avg_monthly_expenses|currency }}</small>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Baseline Monthly Income</label>
                                <input type="number" class="form-control" name="baseline_income" step="0.01" value="{{ historical.avg_monthly_income }}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Baseline Monthly Expenses</label>
                                <input type="number" class="form-control" name="baseline_expenses" step="0.01" value="{{ historical.avg_monthly_expenses }}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Income Change (%)</label>
                                <input type="number" class="form-control" name="income_change_pct" step="0.1" value="0">
                                <small class="text-muted">Positive = increase, Negative = decrease</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Expense Change (%)</label>
                                <input type="number" class="form-control" name="expense_change_pct" step="0.1" value="0">
                                <small class="text-muted">Positive = increase, Negative = decrease</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">New Expense Name</label>
                                <input type="text" class="form-control" name="new_expense_name" placeholder="e.g., Car Payment">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">New Expense Amount (Monthly)</label>
                                <input type="number" class="form-control" name="new_expense_amount" step="0.01" value="0">
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="{{ url_for('scenario_planner.index') }}" class="btn btn-secondary">Cancel</a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-calculator"></i> Create Scenario
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function showScenarioFields() {
    // Hide all scenario-specific fields
    document.querySelectorAll('.scenario-fields').forEach(el => {
        el.style.display = 'none';
    });

    // Show selected scenario fields
    const selectedType = document.getElementById('scenario_type').value;
    if (selectedType) {
        const fieldsDiv = document.getElementById('fields_' + selectedType);
        if (fieldsDiv) {
            fieldsDiv.style.display = 'block';
        }
    }
}

// Show fields on page load if type is pre-selected
document.addEventListener('DOMContentLoaded', function() {
    showScenarioFields();
});
</script>
{% endblock %}
